# Google OAuth Setup for Mobile App

## Problem
When signing in with Google from the mobile app, you get the error:
```
Error 400: redirect_uri_mismatch
```

This happens because the redirect URI used by Expo doesn't match what's configured in Google OAuth Console.

## Solution

### Step 1: Get the Redirect URI

The redirect URI format for Expo apps depends on how you're running the app:

#### For Expo Go (Development)
- **Format**: `exp://localhost:8081` or `exp://127.0.0.1:8081`
- **Note**: The port number (8081) may vary if you're using a different port

#### For Standalone App (Production)
- **Format**: `pgmobile://auth/callback/google` (based on the scheme in app.json)

### Step 2: Add Redirect URIs to Google OAuth Console

1. Go to [Google Cloud Console](https://console.cloud.google.com/)
2. Navigate to **APIs & Services** > **Credentials**
3. Click on your OAuth 2.0 Client ID
4. Under **Authorized redirect URIs**, add:

#### For Development (Expo Go):
```
exp://localhost:8081
exp://127.0.0.1:8081
exp://localhost:19000
exp://127.0.0.1:19000
```

#### For Production (Standalone App):
```
pgmobile://auth/callback/google
```

#### For Web (if testing in browser):
```
http://localhost:8081/auth/callback/google
https://localhost:8081/auth/callback/google
```

### Step 3: Find Your Exact Redirect URI

To find the exact redirect URI your app is using:

1. Run the app: `npm start`
2. Check the console output - Expo will show the redirect URI
3. Or add this to your LoginScreen temporarily to log it:

```javascript
console.log("Redirect URI:", redirectUri);
```

### Step 4: Update Google OAuth Console

After identifying the exact redirect URI:

1. Copy the redirect URI from the console
2. Go to Google OAuth Console
3. Add it to **Authorized redirect URIs**
4. Click **Save**
5. **Wait 5-10 minutes** for changes to propagate

### Step 5: Test

1. Restart your Expo app
2. Try Google Sign-In again
3. The redirect URI should now match

## Common Redirect URIs

Based on your setup, you might need to add:

```
exp://localhost:8081
exp://127.0.0.1:8081
exp://localhost:19000
exp://127.0.0.1:19000
pgmobile://auth/callback/google
http://localhost:8081/auth/callback/google
```

## Troubleshooting

### Still getting redirect_uri_mismatch?

1. **Check the exact URI**: Add `console.log("Redirect URI:", redirectUri)` in LoginScreen
2. **Verify in Google Console**: Make sure the URI matches exactly (including protocol, host, port, path)
3. **Wait for propagation**: Google changes can take 5-10 minutes
4. **Clear cache**: Restart Expo and clear app cache
5. **Check scheme**: Verify `scheme: "pgmobile"` is in app.json

### For Web Testing

If testing in a web browser, you need:
- **Authorized JavaScript origins**: `http://localhost:8081`
- **Authorized redirect URIs**: `http://localhost:8081/auth/callback/google`

### For Production Builds

For production (standalone app), use:
- **Authorized redirect URIs**: `pgmobile://auth/callback/google`

## Notes

- The redirect URI is automatically generated by Expo based on:
  - The `scheme` in `app.json` (for standalone apps)
  - The Expo development server URL (for Expo Go)
- You can see the exact redirect URI in the Expo console when the app starts
- Make sure to add ALL possible redirect URIs you might use (dev, staging, production)

